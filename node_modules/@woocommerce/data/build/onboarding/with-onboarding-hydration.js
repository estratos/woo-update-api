"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withOnboardingHydration = void 0;
/**
 * External dependencies
 */
const compose_1 = require("@wordpress/compose");
const data_1 = require("@wordpress/data");
const element_1 = require("@wordpress/element");
/**
 * Internal dependencies
 */
const constants_1 = require("./constants");
const withOnboardingHydration = (data) => {
    let hydratedProfileItems = false;
    return (0, compose_1.createHigherOrderComponent)((OriginalComponent) => (props) => {
        const onboardingRef = (0, element_1.useRef)(data);
        (0, data_1.useSelect)(
        // @ts-expect-error // @ts-expect-error registry is not defined in the wp.data typings
        (select, registry) => {
            if (!onboardingRef.current) {
                return;
            }
            const { isResolving, hasFinishedResolution } = select(constants_1.STORE_NAME);
            const { startResolution, finishResolution, setProfileItems, } = registry.dispatch(constants_1.STORE_NAME);
            const { profileItems } = onboardingRef.current;
            if (profileItems &&
                !hydratedProfileItems &&
                !isResolving('getProfileItems', []) &&
                !hasFinishedResolution('getProfileItems', [])) {
                startResolution('getProfileItems', []);
                setProfileItems(profileItems, true);
                finishResolution('getProfileItems', []);
                hydratedProfileItems = true;
            }
        }, []);
        return (0, element_1.createElement)(OriginalComponent, Object.assign({}, props));
    }, 'withOnboardingHydration');
};
exports.withOnboardingHydration = withOnboardingHydration;
