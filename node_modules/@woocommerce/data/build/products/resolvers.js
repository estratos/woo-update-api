"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getProductsTotalCount = exports.getProducts = void 0;
/**
 * Internal dependencies
 */
const constants_1 = require("./constants");
const actions_1 = require("./actions");
const utils_1 = require("../utils");
function* getProducts(query) {
    // id is always required.
    const productsQuery = Object.assign({}, query);
    if (productsQuery &&
        productsQuery._fields &&
        !productsQuery._fields.includes('id')) {
        productsQuery._fields = ['id', ...productsQuery._fields];
    }
    try {
        const { items, totalCount } = yield (0, utils_1.request)(constants_1.WC_PRODUCT_NAMESPACE, productsQuery);
        yield (0, actions_1.getProductsTotalCountSuccess)(query, totalCount);
        yield (0, actions_1.getProductsSuccess)(query, items, totalCount);
        return items;
    }
    catch (error) {
        yield (0, actions_1.getProductsError)(query, error);
        throw error;
    }
}
exports.getProducts = getProducts;
function* getProductsTotalCount(query) {
    try {
        const totalsQuery = Object.assign(Object.assign({}, query), { page: 1, per_page: 1 });
        const { totalCount } = yield (0, utils_1.request)(constants_1.WC_PRODUCT_NAMESPACE, totalsQuery);
        yield (0, actions_1.getProductsTotalCountSuccess)(query, totalCount);
        return totalCount;
    }
    catch (error) {
        yield (0, actions_1.getProductsTotalCountError)(query, error);
        throw error;
    }
}
exports.getProductsTotalCount = getProductsTotalCount;
