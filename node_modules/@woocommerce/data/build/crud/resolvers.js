"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createResolvers = void 0;
/**
 * External dependencies
 */
const data_controls_1 = require("@wordpress/data-controls");
/**
 * Internal dependencies
 */
const actions_1 = require("./actions");
const utils_1 = require("../utils");
const createResolvers = ({ resourceName, pluralResourceName, namespace, }) => {
    const getItem = function* (id) {
        try {
            const item = yield (0, data_controls_1.apiFetch)({
                path: `${namespace}/${id}`,
                method: 'GET',
            });
            yield (0, actions_1.getItemSuccess)(item.id, item);
            return item;
        }
        catch (error) {
            yield (0, actions_1.getItemError)(id, error);
            throw error;
        }
    };
    const getItems = function* (query) {
        // Require ID when requesting specific fields to later update the resource data.
        const resourceQuery = Object.assign({}, query);
        if (resourceQuery &&
            resourceQuery._fields &&
            !resourceQuery._fields.includes('id')) {
            resourceQuery._fields = ['id', ...resourceQuery._fields];
        }
        try {
            const { items } = yield (0, utils_1.request)(namespace, resourceQuery);
            yield (0, actions_1.getItemsSuccess)(query, items);
            return items;
        }
        catch (error) {
            yield (0, actions_1.getItemsError)(query, error);
            throw error;
        }
    };
    return {
        [`get${resourceName}`]: getItem,
        [`get${pluralResourceName}`]: getItems,
    };
};
exports.createResolvers = createResolvers;
